<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Kindo Mall</title>

<style>
body{
  font-family: Arial;
  margin:0;
  background:#f5f5f5;
}

header{
  background:#c40000;
  color:white;
  padding:15px;
  text-align:center;
  font-size:24px;
}

#loginBox{
  padding:15px;
  background:white;
  margin:10px;
}

input,button{
  padding:8px;
  margin:4px;
}

button{
  background:#c40000;
  color:white;
  border:none;
  cursor:pointer;
}

.products{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:10px;
  padding:10px;
}

.card{
  background:white;
  padding:10px;
  border-radius:8px;
}

.card img{
  width:100%;
  height:150px;
  object-fit:cover;
}

.adminBtn{
  background:black;
  margin-top:5px;
}

footer{
  background:#222;
  color:white;
  text-align:center;
  padding:15px;
}
a{color:white;}
</style>
</head>

<body>

<header>Kindo Mall</header>

<!-- LOGIN -->
<div id="loginBox">
<h3>Panel Admin</h3>
<input id="email" placeholder="Correo">
<input id="password" type="password" placeholder="Contraseña">
<button onclick="login()">Entrar</button>
</div>

<button id="logoutBtn" style="display:none;" onclick="logout()">Cerrar sesión</button>

<!-- AGREGAR PRODUCTO -->
<div id="adminPanel" style="display:none;padding:10px;">
<h3>Agregar producto</h3>

<input id="title" placeholder="Nombre"><br>
<input id="price" placeholder="Precio"><br>
<input id="image" placeholder="URL imagen"><br>

<button onclick="addProduct()">Guardar</button>
</div>

<!-- PRODUCTOS -->
<div class="products" id="products"></div>

<footer>
Instagram:
<a href="https://www.instagram.com/kindomall/" target="_blank">
@kindomall
</a>
<br>
WhatsApp:
<a href="https://api.whatsapp.com/message/GHE4RKLD422VO1" target="_blank">
Contactar
</a>
<br>
Ubicación:
<a href="https://maps.app.goo.gl/gWtkL2p69zGwPBgF9" target="_blank">
Ver mapa
</a>
<br><br>
Desarrollado por Cesar Dev
</footer>

<script type="module">
import { initializeApp } from
"https://www.gstatic.com/firebasejs/9.1.3/firebase-app.js";

import {
getFirestore,
collection,
addDoc,
onSnapshot,
deleteDoc,
doc
} from
"https://www.gstatic.com/firebasejs/9.1.3/firebase-firestore.js";

import {
getAuth,
signInWithEmailAndPassword,
signOut,
onAuthStateChanged
} from
"https://www.gstatic.com/firebasejs/9.1.3/firebase-auth.js";

const firebaseConfig = {
apiKey: "AIzaSyCQd2Aw91y8Kb0c9EoDJTd9FvdlsfRSDqI",
authDomain: "kindo-mall.firebaseapp.com",
projectId: "kindo-mall",
storageBucket: "kindo-mall.appspot.com",
messagingSenderId: "463969508011",
appId: "1:463969508011:web:1ee78cb55a67dc0a27f5ee"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

const container = document.getElementById("products");
let admin = false;

function renderProducts(list){
container.innerHTML = "";

list.forEach(p=>{
const div = document.createElement("div");
div.className="card";

div.innerHTML = `
<img src="${p.image}">
<h3>${p.title}</h3>
<p>Precio: $${p.price}</p>
${admin ? `<button class="adminBtn"
onclick="deleteProduct('${p.id}')">
Eliminar
</button>` : ""}
`;

container.appendChild(div);
});
}

onSnapshot(collection(db,"products"), snap=>{
let arr=[];
snap.forEach(d=>{
arr.push({id:d.id,...d.data()});
});
renderProducts(arr);
});

window.addProduct = async ()=>{
await addDoc(collection(db,"products"),{
title:title.value,
price:price.value,
image:image.value
});
alert("Producto agregado");
};

window.deleteProduct = async id=>{
await deleteDoc(doc(db,"products",id));
};

window.login = async ()=>{
await signInWithEmailAndPassword(
auth,
email.value,
password.value
);
};

window.logout = ()=>signOut(auth);

onAuthStateChanged(auth,user=>{
admin = !!user;

loginBox.style.display = admin ? "none":"block";
logoutBtn.style.display = admin ? "block":"none";
adminPanel.style.display = admin ? "block":"none";
});
</script>

</body>
</html>
