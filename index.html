<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kindo Mall</title>

<script src="https://cdn.tailwindcss.com"></script>

<!-- Firebase SDK -->
<script type="module">
  // Importar las funciones necesarias de Firebase
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.3/firebase-app.js";
  import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/9.1.3/firebase-firestore.js";
  import { getStorage, ref, uploadBytesResumable, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.1.3/firebase-storage.js";

  // Configuración de Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyCQd2Aw91y8Kb0c9EoDJTd9FvdlsfRSDqI",
    authDomain: "kindo-mall.firebaseapp.com",
    projectId: "kindo-mall",
    storageBucket: "kindo-mall.appspot.com",
    messagingSenderId: "463969508011",
    appId: "1:463969508011:web:1ee78cb55a67dc0a27f5ee",
    measurementId: "G-L6YSJF13WQ"
  };

  // Inicializar Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const storage = getStorage(app);

  // Función para subir imágenes
  function uploadImage(file) {
    const storageRef = ref(storage, 'images/' + file.name);
    const uploadTask = uploadBytesResumable(storageRef, file);

    return new Promise((resolve, reject) => {
      uploadTask.on('state_changed',
        (snapshot) => {
          // Progreso de la carga (si es necesario mostrar progreso)
        },
        (error) => {
          reject(error);
        },
        () => {
          getDownloadURL(uploadTask.snapshot.ref).then((downloadURL) => {
            resolve(downloadURL);
          });
        }
      );
    });
  }

  // Función para agregar un producto a Firestore
  async function saveProduct(title, price, desc, imgs) {
    try {
      const docRef = await addDoc(collection(db, "products"), {
        title: title,
        price: price,
        description: desc,
        images: imgs
      });
      console.log("Producto agregado con ID: ", docRef.id);
    } catch (e) {
      console.error("Error al agregar producto: ", e);
    }
  }

  // Función para agregar un producto
  async function addProduct() {
    if (!isAdmin) return;

    const files = document.getElementById("images").files;
    if (!files.length) return alert("Sube al menos una imagen");

    const imgs = [];
    let loaded = 0;

    for (const f of files) {
      try {
        const imageURL = await uploadImage(f);
        imgs.push(imageURL);
        loaded++;
        if (loaded === files.length) {
          const title = document.getElementById("title").value;
          const price = Number(document.getElementById("price").value);
          const desc = document.getElementById("desc").value;
          saveProduct(title, price, desc, imgs);
          renderProducts();
          closeModals();
        }
      } catch (error) {
        alert("Error al subir la imagen: " + error.message);
      }
    }
  }

</script>

</head>
<body class="text-slate-900">
<!-- El resto de tu código HTML sigue igual, sin cambios en la estructura visual -->

<script>
/* =====================
   ESTADO
===================== */
let products = [];
let isAdmin = false;

// Funciones de modales, login y renderizado de productos siguen igual
</script>

</body>
</html>
